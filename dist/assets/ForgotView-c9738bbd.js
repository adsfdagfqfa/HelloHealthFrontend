import{_ as B,e as S,f as m,r as c,o as I,g as F,w as s,b as t,n as w,a as n,h,t as b,i as k,j as P,E as T,p as E,d as H}from"./index-96eb2e51.js";import{c as U}from"./changeTheme-5bb595fb.js";const N=p=>(E("data-v-45f7f601"),p=p(),H(),p),$=N(()=>n("div",{class:"titleWrapper"},[n("div",{class:"forgotTitle"},"找回密码"),n("div",{class:"forgotSubTitle"},"验证手机以重设密码")],-1)),M={class:"inputWithButton"},R={class:"errorText"},W={class:"textButtonHolder"},j={class:"forgotButtonHolder"},q={__name:"ForgotView",setup(p){U("#93b27b");const o=S({user_phone:"",verification_code:"",new_password:""}),g=m(""),a=m(""),e=m(!1),C=async()=>{a.value="",e.value=!1;let v=/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/;if(o.user_phone===""){a.value="请输入手机号！",e.value=!0;return}else if(v.test(o.user_phone)){if(o.verification_code===""){a.value="请输入验证码！",e.value=!0;return}else if(o.password===""){a.value="请输入新密码！",e.value=!0;return}else if(g.value!==o.password){a.value="两次密码输入不一致！",e.value=!0;return}}else{a.value="请输入正确的手机号！",e.value=!0;return}k.post("/api/Register/ForgotPassword",o).then(l=>{e.value=!1,a.value="",alert("密码重设成功！"),P.push("/login")}).catch(l=>{if(!l.network)switch(l.errorCode){case 105:a.value="验证码错误！",e.value=!0;break;case 106:a.value="用户不存在！",e.value=!0;break;default:l.defaultHandler()}})},_=()=>{e.value=!1},i=m(0),y=async()=>{a.value="",e.value=!1;const v={user_phone:o.user_phone};let l=/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/;if(o.user_phone===""){a.value="请输入手机号！",e.value=!0;return}else if(!l.test(o.user_phone)){a.value="请输入正确的手机号！",e.value=!0;return}i.value=60;const d=setInterval(()=>{i.value-=1,i.value===0&&clearInterval(d)},1e3);k.post("/api/Register/SendVerificationCode",v).then(r=>{e.value=!1,a.value="",T.success("发送成功。")}).catch(r=>{if(!r.network)switch(r.errorCode){case 104:a.value="发送失败，请稍后重试",e.value=!0;break;default:r.defaultHandler()}})};return(v,l)=>{const d=c("el-input"),r=c("el-form-item"),f=c("el-button"),V=c("router-link"),x=c("el-form");return I(),F(x,{"label-position":"top","label-width":"60px",model:o,class:"forgotForm"},{default:s(()=>[$,t(r,{label:"手机号",class:w({error:e.value})},{default:s(()=>[t(d,{modelValue:o.user_phone,"onUpdate:modelValue":l[0]||(l[0]=u=>o.user_phone=u),onClick:_},null,8,["modelValue"])]),_:1},8,["class"]),t(r,{label:"验证码",class:w({error:e.value})},{default:s(()=>[n("div",M,[t(d,{modelValue:o.verification_code,"onUpdate:modelValue":l[1]||(l[1]=u=>o.verification_code=u),onClick:_},null,8,["modelValue"]),t(f,{disabled:i.value>0,onClick:y},{default:s(()=>[h(b(i.value>0?`重新发送(${i.value})`:"发送验证码"),1)]),_:1},8,["disabled"])])]),_:1},8,["class"]),t(r,{label:"新密码",class:w({error:e.value})},{default:s(()=>[t(d,{modelValue:o.password,"onUpdate:modelValue":l[2]||(l[2]=u=>o.password=u),type:"password",onClick:_,"show-password":""},null,8,["modelValue"])]),_:1},8,["class"]),t(r,{label:"确认密码",class:w({error:e.value})},{default:s(()=>[t(d,{modelValue:g.value,"onUpdate:modelValue":l[3]||(l[3]=u=>g.value=u),type:"password",onClick:_,"show-password":""},null,8,["modelValue"])]),_:1},8,["class"]),n("div",R,b(a.value),1),n("div",W,[t(V,{to:"/login"},{default:s(()=>[t(f,{type:"primary",link:""},{default:s(()=>[h("已有账号?点此登录")]),_:1})]),_:1}),t(V,{to:"/login/register"},{default:s(()=>[t(f,{type:"primary",link:""},{default:s(()=>[h("注册")]),_:1})]),_:1})]),n("div",j,[t(f,{type:"primary",onClick:C},{default:s(()=>[h("重设密码")]),_:1})])]),_:1},8,["model"])}}},A=B(q,[["__scopeId","data-v-45f7f601"]]);export{A as default};
